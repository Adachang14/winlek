<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>วินเลขรวม(2ตัว+3ตัว)</title>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  body{
    font-family:'Sarabun',sans-serif;
    background:#f3e5f5;
    padding:20px;
    text-align:center;
  }
  .box{
    max-width:650px;
    margin:auto;
    background:#fff;
    padding:22px;
    border-radius:18px;
    box-shadow:0 8px 22px rgba(0,0,0,.15);
  }
  h2{ color:#8e24aa; margin:0 0 14px; }

  textarea{
    width:100%;
    height:250px;
    font-size:16px;
    padding:12px;
    border-radius:12px;
    border:1px solid #ddd;
    outline:none;
    resize: vertical;
  }

  /* แถวปุ่มหลัก */
  .btn-row{
    margin-top:14px;
    display:flex;
    gap:8px;
    justify-content:center;
    flex-wrap:wrap;
  }
   
  /* แถวปุ่มเพิ่มเติม (Copy แยก) */
  .btn-row-sub{
    margin-top:10px;
    display:flex;
    gap:8px;
    justify-content:center;
    flex-wrap:wrap;
    padding-top: 10px;
    border-top: 1px dashed #ddd;
  }

  button{
    padding:11px 19px;
    font-size:15px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    color:#fff;
    font-weight: bold;
    transition: transform 0.1s;
  }
  button:active { transform: scale(0.95); }
   
  /* สีปุ่มต่างๆ */
  .btn-run{ background:#8e24aa; } /* ม่วง */
  .btn-clear{ background:#ff5722; } /* ส้ม */
  .btn-copy-all{ background:#2196f3; } /* ฟ้า */
  .btn-home{ background:#607d8b; } /* เทา */
   
  .btn-copy-2{ background:#00897b; } /* เขียวเข้ม */
  .btn-copy-3{ background:#d81b60; } /* ชมพูเข้ม */

  .result{
    margin-top:18px;
    text-align:left;
    background:#f8eafc;
    padding:16px;
    border-radius:14px;
    white-space:pre-wrap;
    word-break:break-word;
    line-height:1.6;
    font-size: 16px;
  }

  .copied-msg{
    display:none;
    margin-top:10px;
    color:green;
    font-weight:800;
  }

  /* สไตล์ Popup แจ้งเตือน */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    align-items: center;
    justify-content: center;
  }
  .modal-box {
    background: white;
    padding: 25px;
    border-radius: 15px;
    width: 90%;
    max-width: 420px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  }
  .modal-text {
    font-size: 18px;
    margin-bottom: 20px;
    white-space: pre-wrap;
    color: #333;
    line-height: 1.5;
  }
  .modal-btn-copy {
    background: #007bff;
    margin-bottom: 10px;
    width: 100%;
  }
  .modal-btn-close {
    background: #555;
    width: 100%;
  }
</style>
</head>

<body>
<div class="box">
  <h2>วินเลขรวม(2ตัว+3ตัว ผลลัพที่ได้ยังไม่ได้กลับ)</h2>

  <textarea id="input" placeholder="พิมพ์เลขแล้วเคาะ Spacebar จะขึ้นบรรทัดใหม่ให้
(Enter = คำนวณทันที)"></textarea>

  <div class="btn-row">
    <button class="btn-run" onclick="run()">วินเลขรวม</button>
    <button class="btn-clear" onclick="resetAll()">เริ่มใหม่</button>
    <button class="btn-copy-all" onclick="copyAllMixed()">คัดลอกทั้งหมด</button>
    <button class="btn-home" onclick="goHome()">กลับหน้าหลัก</button>
  </div>

  <div class="btn-row-sub">
    <button class="btn-copy-2" onclick="copyOnlyDigit(2)">คัดลอกเฉพาะ 2 ตัว</button>
    <button class="btn-copy-3" onclick="copyOnlyDigit(3)">คัดลอกเฉพาะ 3 ตัว</button>
  </div>

  <div id="copied" class="copied-msg">คัดลอกแล้ว!</div>
  <div id="output" class="result"></div>
</div>

<div id="customModal" class="modal-overlay">
  <div class="modal-box">
    <div id="modalMsg" class="modal-text"></div>
    <button id="modalCopyBtn" class="modal-btn-copy" onclick="copyQuickMsg()">คัดลอกคำพูดส่งลูกค้า</button>
    <button class="modal-btn-close" onclick="closeModal()">ปิด (แก้ไขเลข)</button>
  </div>
</div>

<script>
  const MIN_LEN = 3;
  let globalResults = [];

  function toThaiNumber(n){
    const th = ['๐','๑','๒','๓','๔','๕','๖','๗','๘','๙'];
    return n.toString().split('').map(d => th[+d] ?? d).join('');
  }

  function hasDuplicates(str){
    return /(.).*\1/.test(str);
  }

  function normalizeToSets(raw){
    // แปลงทุกอย่างที่ไม่ใช่เลขเป็นช่องว่าง แล้วกรองเอาเฉพาะ 3 หลักขึ้นไป
    const cleaned = raw.replace(/[^\d]+/g, ' ').trim();
    if(!cleaned) return [];
    return cleaned.split(/\s+/).map(s => s.trim()).filter(s => s.length >= MIN_LEN);
  }

  function getCombinations(chars, size) {
    let result = [];
    const combine = (current, start) => {
      if (current.length === size) {
        result.push(current.join(''));
        return;
      }
      for (let i = start; i < chars.length; i++) {
        combine([...current, chars[i]], i + 1);
      }
    };
    combine([], 0);
    return result;
  }

  // ✅ แก้ไข: รับค่า text สำหรับ copy แยกต่างหาก
  function openModal(displayText, copyText, showCopyBtn = false) {
    const modal = document.getElementById('customModal');
    const msgBox = document.getElementById('modalMsg');
    const copyBtn = document.getElementById('modalCopyBtn');
     
    msgBox.textContent = displayText;
    
    // ฝังข้อความที่จะ copy ไว้ในปุ่มเลย (เพื่อให้กดแล้วได้ข้อความที่ถูกต้อง)
    copyBtn.setAttribute('data-copy', copyText);

    copyBtn.style.display = showCopyBtn ? 'block' : 'none';
    modal.style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('customModal').style.display = 'none';
    setTimeout(() => document.getElementById('input').focus(), 100);
  }

  function copyQuickMsg() {
    // ✅ แก้ไข: ดึงข้อความจาก data-copy แทน (จะได้ไม่เอาคำว่า "❗️เลขซ้ำเเจ้งลค.=" ติดไปด้วย)
    const btn = document.getElementById('modalCopyBtn');
    const textToCopy = btn.getAttribute('data-copy');

    navigator.clipboard.writeText(textToCopy).then(() => {
      const oldText = btn.innerText;
      btn.innerText = "✅ คัดลอกแล้ว!";
      setTimeout(() => btn.innerText = oldText, 1500);
    });
  }

  // ✅ แก้ไข: วนลูปหาเลขซ้ำให้ครบทุกชุด แล้วค่อยแจ้งเตือนทีเดียว
  function validateSets(sets){
    let errors = []; // เก็บรายการเลขซ้ำทั้งหมด
    let realIndex = 0;

    for (let i=0; i<sets.length; i++){
      const num = sets[i];
      if(!num) continue;
      realIndex++;

      if(hasDuplicates(num)){
        // เจอเลขซ้ำ เก็บใส่ตะกร้าไว้ก่อน
        errors.push(`(พบในชุดที่ ${realIndex} : ${num})`);
      }
    }

    // ถ้ามี error อย่างน้อย 1 อัน ให้แสดงผล
    if(errors.length > 0){
        // สร้างส่วนหัวข้อความ (บรรทัดแรก)
        const firstError = errors[0];
        
        // ส่วนเสริม (ถ้ามีหลายชุด) ให้ขึ้นบรรทัดใหม่
        const otherErrors = errors.slice(1).join("\n"); 
        const tail = otherErrors ? "\n" + otherErrors : "";

        // 1. ข้อความสำหรับโชว์ในกล่อง (มีหัวข้อ ❗️เลขซ้ำเเจ้งลค.=)
        const displayMsg = "❗️เลขซ้ำเเจ้งลค.=เลขซ้ำจ้า แอดขอเลขใหม่จ้าพี่ " + firstError + tail;

        // 2. ข้อความสำหรับก๊อปปี้ (ตัดหัวข้อทิ้ง เอาแค่ "เลขซ้ำจ้า...")
        const copyMsg = "เลขซ้ำจ้า แอดขอเลขใหม่จ้าพี่ " + firstError + tail;

        openModal(displayMsg, copyMsg, true);
        return { ok:false };
    }

    return { ok:true };
  }

  function run(){
    const raw = document.getElementById("input").value;
    const sets = normalizeToSets(raw);

    if(sets.length > 0) {
        document.getElementById("input").value = sets.join("\n");
    }

    if(sets.length === 0){
      document.getElementById("output").textContent = "ไม่พบชุดเลขสำหรับวิน (ต้องมี 3 ตัวขึ้นไป)";
      document.getElementById("copied").style.display = "none";
      return;
    }

    const v = validateSets(sets);
    if(!v.ok){
      document.getElementById("output").textContent = "";
      return;
    }

    let out = "";
    let count = 0;
    globalResults = [];

    sets.forEach((num) => {
      count++;
      const digits = num.split('');
      const pairs = getCombinations(digits, 2);
      const triplets = getCombinations(digits, 3);

      globalResults.push({ id: count, pairs: pairs, triplets: triplets });

      out += `ชุดที่${toThaiNumber(count)}\n`;
      out += pairs.join(" ") + "\n";
      out += triplets.join(" ") + "\n\n";
    });

    document.getElementById("output").textContent = out.trim();
    document.getElementById("copied").style.display = "none";
  }

  function resetAll(){
    document.getElementById("input").value = "";
    document.getElementById("output").textContent = "";
    document.getElementById("copied").style.display = "none";
    globalResults = [];
    setTimeout(() => {
        const el = document.getElementById("input");
        if(el) el.focus();
    }, 0);
  }

  function copyAllMixed(){
    const raw = document.getElementById("output").textContent;
    if(!raw.trim()) return;
    const cleanText = raw.replace(/^ชุดที่.*$/gm, "").replace(/^\s*[\r\n]/gm, ""); 
    copyToClipboard(cleanText, "คัดลอกทั้งหมดแล้ว!");
  }

  function copyOnlyDigit(digits){
    if(globalResults.length === 0) return;
    let textToCopy = "";
    globalResults.forEach(item => {
        if(digits === 2 && item.pairs.length > 0) textToCopy += item.pairs.join(" ") + " ";
        else if(digits === 3 && item.triplets.length > 0) textToCopy += item.triplets.join(" ") + " ";
    });
    if(!textToCopy.trim()) {
        openModal("ไม่มีเลข " + digits + " ตัว ให้คัดลอก", "", false);
        return;
      }
    copyToClipboard(textToCopy.trim(), `คัดลอกเฉพาะ ${digits} ตัวแล้ว!`);
  }

  function copyToClipboard(text, alertMsg){
    navigator.clipboard.writeText(text).then(() => {
      const msg = document.getElementById("copied");
      msg.textContent = alertMsg;
      msg.style.display = "block";
      setTimeout(() => msg.style.display = "none", 1500);
    });
  }

  function goHome(){ window.location.href = "index.html"; }

  document.getElementById("input").addEventListener("keydown", function(e){
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      run();
    }
    else if(e.key === " "){
        e.preventDefault(); 
        const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + "\n" + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 1;
    }
  });

  document.getElementById("input").addEventListener("paste", function(e){
    setTimeout(() => {
        const raw = this.value;
        const sets = normalizeToSets(raw);
        if(sets.length > 0) {
            this.value = sets.join("\n");
        }
    }, 50);
  });

  window.addEventListener("load", () => document.getElementById("input").focus());
</script>
</body>
</html>
