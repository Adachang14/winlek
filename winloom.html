<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>วินเลขรวม (2ตัว+3ตัว)</title>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  body{
    font-family:'Sarabun',sans-serif;
    background:#f3e5f5;
    padding:20px;
    text-align:center;
  }
  .box{
    max-width:650px;
    margin:auto;
    background:#fff;
    padding:22px;
    border-radius:18px;
    box-shadow:0 8px 22px rgba(0,0,0,.15);
  }
  h2{ color:#8e24aa; margin:0 0 14px; }

  textarea{
    width:100%;
    height:250px;
    font-size:18px; /* ตัวใหญ่ขึ้นหน่อยจะได้เห็นชัด */
    padding:12px;
    border-radius:12px;
    border:1px solid #ddd;
    outline:none;
    resize: vertical;
  }
  /* เวลาโฟกัส ให้กรอบเป็นสีสวยๆ */
  textarea:focus {
    border-color: #8e24aa;
    box-shadow: 0 0 8px rgba(142, 36, 170, 0.2);
  }

  /* แถวปุ่มหลัก */
  .btn-row{
    margin-top:14px;
    display:flex;
    gap:8px;
    justify-content:center;
    flex-wrap:wrap;
  }
  
  /* แถวปุ่มเพิ่มเติม (Copy แยก) */
  .btn-row-sub{
    margin-top:10px;
    display:flex;
    gap:8px;
    justify-content:center;
    flex-wrap:wrap;
    padding-top: 10px;
    border-top: 1px dashed #ddd;
  }

  button{
    padding:10px 18px;
    font-size:15px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    color:#fff;
    font-weight: bold;
    transition: transform 0.1s;
  }
  button:active { transform: scale(0.95); }
  
  /* สีปุ่มต่างๆ */
  .btn-run{ background:#8e24aa; } /* ม่วง */
  .btn-clear{ background:#ff5722; } /* ส้ม */
  .btn-copy-all{ background:#2196f3; } /* ฟ้า */
  .btn-home{ background:#607d8b; } /* เทา */
  
  .btn-copy-2{ background:#00897b; } /* เขียวเข้ม */
  .btn-copy-3{ background:#d81b60; } /* ชมพูเข้ม */

  .result{
    margin-top:18px;
    text-align:left;
    background:#f8eafc;
    padding:16px;
    border-radius:14px;
    white-space:pre-wrap;
    word-break:break-word;
    line-height:1.6;
    font-size: 16px;
  }

  .copied-msg{
    display:none;
    margin-top:10px;
    color:green;
    font-weight:800;
  }
</style>
</head>

<body>
<div class="box">
  <h2>วินเลขรวม (ออกทั้ง 2 และ 3 ตัว)</h2>

  <textarea id="input" placeholder="พิมพ์/วางเลขได้เลย เช่น
123
4567"></textarea>

  <div class="btn-row">
    <button class="btn-run" onclick="run()">วินเลขรวม</button>
    <button class="btn-clear" onclick="resetAll()">เริ่มใหม่</button>
    <button class="btn-copy-all" onclick="copyAllMixed()">คัดลอกทั้งหมด</button>
    <button class="btn-home" onclick="goHome()">กลับหน้าหลัก</button>
  </div>

  <div class="btn-row-sub">
    <button class="btn-copy-2" onclick="copyOnlyDigit(2)">คัดลอกเฉพาะ 2 ตัว</button>
    <button class="btn-copy-3" onclick="copyOnlyDigit(3)">คัดลอกเฉพาะ 3 ตัว</button>
  </div>

  <div id="copied" class="copied-msg">คัดลอกแล้ว!</div>
  <div id="output" class="result"></div>
</div>

<script>
  const MIN_LEN = 3;
  let globalResults = []; // เก็บผลลัพธ์แยกชุด

  function toThaiNumber(n){
    const th = ['๐','๑','๒','๓','๔','๕','๖','๗','๘','๙'];
    return n.toString().split('').map(d => th[+d] ?? d).join('');
  }

  function hasDuplicates(str){
    return /(.).*\1/.test(str);
  }

  function normalizeToSets(raw){
    const cleaned = raw.replace(/[^\d]+/g, '\n').trim();
    if(!cleaned) return [];
    return cleaned.split(/\n+/).map(s => s.trim()).filter(Boolean);
  }

  // สูตรวินเลข (Combination)
  function getCombinations(chars, size) {
    let result = [];
    const combine = (current, start) => {
      if (current.length === size) {
        result.push(current.join(''));
        return;
      }
      for (let i = start; i < chars.length; i++) {
        combine([...current, chars[i]], i + 1);
      }
    };
    combine([], 0);
    return result;
  }

  function validateSets(sets){
    let realIndex = 0;
    const bad = [];

    for (let i=0;i<sets.length;i++){
      const num = sets[i];
      if(!num) continue;
      realIndex++;

      if(num.length < MIN_LEN){
        bad.push(`ชุดที่${toThaiNumber(realIndex)} (${num})`);
        continue;
      }

      if(hasDuplicates(num)){
        alert("❗️เลขซ้ำ เเจ้งลค.= เลขซ้ำจ้า แอดขอเลขใหม่จ้าพี่\n(พบในชุดที่ " + toThaiNumber(realIndex) + " : " + num + ")");
        return { ok:false };
      }
    }

    if(bad.length){
      alert("❗️มีชุดที่ผิด (ต้องอย่างน้อย 3 ตัว)\n" + bad.join("\n") + "\n\nแก้ให้ครบก่อนนะ แล้วค่อยวินใหม่");
      return { ok:false };
    }

    return { ok:true };
  }

  function run(){
    const raw = document.getElementById("input").value;
    const sets = normalizeToSets(raw);

    if(sets.length === 0){
      document.getElementById("output").textContent = "กรุณาพิมพ์เลขอย่างน้อย 3 ตัวต่อชุด";
      document.getElementById("copied").style.display = "none";
      return;
    }

    const v = validateSets(sets);
    if(!v.ok){
      document.getElementById("output").textContent = "";
      return;
    }

    let out = "";
    let count = 0;
    globalResults = []; // ล้างค่าเก่า

    sets.forEach((num) => {
      count++;
      const digits = num.split('');
      
      // คำนวณ
      const pairs = getCombinations(digits, 2);
      const triplets = getCombinations(digits, 3);

      // เก็บไว้กดปุ่มแยก
      globalResults.push({
        id: count,
        pairs: pairs,
        triplets: triplets
      });

      // แสดงผล
      out += `ชุดที่${toThaiNumber(count)}\n`;
      out += pairs.join(" ") + "\n";   // บรรทัด 2 ตัว
      out += triplets.join(" ") + "\n\n"; // บรรทัด 3 ตัว
    });

    document.getElementById("output").textContent = out.trim();
    document.getElementById("copied").style.display = "none";
  }

  function resetAll(){
    document.getElementById("input").value = "";
    document.getElementById("output").textContent = "";
    document.getElementById("copied").style.display = "none";
    globalResults = [];
    
    // เรียกใช้ฟังก์ชัน focusInput เพื่อโฟกัสและคลุมดำทันที
    setTimeout(() => {
        focusInput(true);
    }, 0);
  }

  // ก๊อปปี้ทั้งหมด (เหมือนที่ตาเห็น)
  function copyAllMixed(){
    const raw = document.getElementById("output").textContent;
    if(!raw.trim()) return;
    
    // ตัดคำว่าชุดที่ออก (ถ้าต้องการ)
    const cleanText = raw.replace(/^ชุดที่.*$/gm, "").replace(/^\s*[\r\n]/gm, ""); 
    copyToClipboard(cleanText, "คัดลอกทั้งหมดแล้ว!");
  }

  // ก๊อปปี้แยกตามจำนวนตัว (2 หรือ 3)
  function copyOnlyDigit(digits){
    if(globalResults.length === 0) return;

    let textToCopy = "";
    
    globalResults.forEach(item => {
        if(digits === 2 && item.pairs.length > 0) {
            textToCopy += item.pairs.join(" ") + " ";
        } else if(digits === 3 && item.triplets.length > 0) {
            textToCopy += item.triplets.join(" ") + " ";
        }
    });

    if(!textToCopy.trim()) {
        alert("ไม่มีเลข " + digits + " ตัว ให้คัดลอก");
        return;
      }

    copyToClipboard(textToCopy.trim(), `คัดลอกเฉพาะ ${digits} ตัวแล้ว!`);
  }

  function copyToClipboard(text, alertMsg){
    navigator.clipboard.writeText(text).then(() => {
      const msg = document.getElementById("copied");
      msg.textContent = alertMsg;
      msg.style.display = "block";
      setTimeout(() => msg.style.display = "none", 1500);
    });
  }

  function goHome(){
    window.location.href = "index.html"; 
  }

  // แปลง input ให้ขึ้นบรรทัดใหม่เมื่อเจอตัวที่ไม่ใช่ตัวเลข
  document.getElementById("input").addEventListener("input", function(){
    const before = this.value;
    const after = before.replace(/[^\d]+/g, '\n');
    if(before !== after) this.value = after;
  });

  // -----------------------------------------------------------
  // ✅ ส่วนของ Smart Auto Focus (เหมือนหน้าหลัก 100%)
  // -----------------------------------------------------------
  let lockUntil = 0;
  let isPointerDown = false;

  function now() { return Date.now(); }

  function hasSelection() {
    const sel = window.getSelection && window.getSelection();
    return sel && sel.rangeCount > 0 && sel.toString().length > 0;
  }

  function shouldSkipFocus() {
    if (now() < lockUntil) return true;
    if (isPointerDown) return true;
    if (hasSelection()) return true;

    const ae = document.activeElement;
    if (ae && ae.id === 'input') return true;
    return false;
  }

  function focusInput(selectAll = true) {
    if (shouldSkipFocus()) return;
    const el = document.getElementById('input');
    if (!el) return;
    el.focus({ preventScroll: true });
    if (selectAll) {
      try { el.select(); } catch (_) {}
    }
  }

  const resultsEl = document.getElementById('output');
  if (resultsEl) {
    resultsEl.addEventListener('pointerdown', () => { lockUntil = now() + 2500; }, { passive: true });
    resultsEl.addEventListener('wheel', () => { lockUntil = now() + 2500; }, { passive: true });
  }

  document.addEventListener('pointerdown', () => { isPointerDown = true; }, { passive: true });
  document.addEventListener('pointerup',   () => { isPointerDown = false; }, { passive: true });
  document.addEventListener('pointercancel', () => { isPointerDown = false; }, { passive: true });

  window.addEventListener('load', () => focusInput(true));
  window.addEventListener('pageshow', () => setTimeout(() => focusInput(true), 0));

  document.addEventListener('visibilitychange', function () {
    if (!document.hidden) setTimeout(() => focusInput(true), 0);
  });
</script>
</body>
</html>
